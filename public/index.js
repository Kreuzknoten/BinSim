!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class i{constructor(e,t){this.x=e,this.y=t}plus(e){let t=this.x+e.x,n=this.y+e.y;return new i(t,n)}minus(e){let t=this.x-e.x,n=this.y-e.y;return new i(t,n)}inverse(){let e=-1*this.x,t=-1*this.y;return new i(e,t)}toString(){return"x = "+this.x+" y = "+this.y}}class o extends i{}class r extends i{}class s{constructor(e){this.gridPosition=e,this.size=new i(3,3),this.background="#878787"}moveTo(e){this.gridPosition.x=e.x,this.gridPosition.y=e.y}isGridCoordinateWithingComponent(e,t){let n=this.gridPosition.x-1<t.x,i=t.x<this.gridPosition.x+this.size.x+1,o=this.gridPosition.y-1<t.y,r=t.y<this.gridPosition.y+this.size.y+1;return!!(n&&i&&o&&r)}draw(e,t){e.fillStyle="grey",e.fillRect(this.gridPosition.x*t.gridBlockSize*t.scaleFactor+t.canvasTranslation.x,this.gridPosition.y*t.gridBlockSize*t.scaleFactor+t.canvasTranslation.y,this.size.x*t.gridBlockSize*t.scaleFactor,this.size.x*t.gridBlockSize*t.scaleFactor)}}class a{setEvent(e,t){this.event=e,this.hitComponent=t}}class l{constructor(){this.scaleFactor=1,this.gridBlockSize=10,this.canvasTranslation=new i(0,0)}zoomBy(e){this.scaleFactor=this.scaleFactor*e}translateByCanvasCoordinate(e){this.canvasTranslation=this.canvasTranslation.plus(e)}getCanvasCoordinateFromGridCoordinate(e){let t=Math.round(e.x*this.gridBlockSize*this.scaleFactor)+this.canvasTranslation.x,n=Math.round(e.y*this.gridBlockSize*this.scaleFactor)+this.canvasTranslation.y;return new r(t,n)}getCanvasCoordinateeRelativeToOriginFromGridCoordinate(e){let t=Math.round(e.x*this.gridBlockSize*this.scaleFactor),n=Math.round(e.y*this.gridBlockSize*this.scaleFactor);return new r(t,n)}getGridCoordinateFromCanvasCoordinate(e){let t=Math.round((e.x-this.canvasTranslation.x)/this.gridBlockSize/this.scaleFactor),n=Math.round((e.y-this.canvasTranslation.y)/this.gridBlockSize/this.scaleFactor);return new o(t,n)}getGridCoordinateRelativeToOriginFromCanvasCoordinate(e){let t=Math.round(e.x/this.gridBlockSize/this.scaleFactor),n=Math.round(e.y/this.gridBlockSize/this.scaleFactor);return new o(t,n)}toString(){return"scaleFactor: "+this.scaleFactor+" gridBlockSize: "+this.gridBlockSize+" canvasTranslation: "+this.canvasTranslation.toString()}}HTMLCanvasElement,CanvasRenderingContext2D;var d=document.getElementById("canvas");d.getContext("2d");d.width=300,d.height=300;let c=new class{constructor(){this.components=new Array}addComponent(e){this.components.push(e)}removeComponent(e){}},h=new class{constructor(e,t){this.canvas=e,this.componentTree=t,this.grid=new l,this.draw()}draw(){var e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),this.componentTree.components.forEach(t=>{t.draw(e,this.grid)})}}(d,c);new class{constructor(e,t){this.canvas=e,this.renderer=t,this.lastLeftMouseDownEventInfo=new a,this.lastRightMouseDownEventInfo=new a,this.lastMouseMoveEventInfo=new a,this.isDraggingComponent=!1,this.isDraggingGrid=!1,document.getElementById("canvas").addEventListener("mousedown",e=>{this.onCanvasMouseDown(e)},!1),document.getElementById("canvas").addEventListener("mouseup",e=>{this.onCanvasMouseUp(e)},!1),document.getElementById("canvas").addEventListener("mousemove",e=>{this.onCanvasMouseMove(e)},!1),document.getElementById("canvas").addEventListener("wheel",e=>{this.onCanvasScroll(e)},!1)}getMouseCanvasCoordinateRelativeToOrigin(e){let t=this.canvas.getBoundingClientRect(),n=e.pageX-t.left,i=e.pageY-t.top;return new r(n,i)}getComponentsWithinGridCoordinate(e){let t=this.renderer.componentTree.components,n=new Array;return t.forEach(t=>{t.isGridCoordinateWithingComponent(this.renderer.grid,e)&&n.push(t)}),0==n.length?null:n[0]}onCanvasMouseDown(e){let t=e.button,n=this.getMouseCanvasCoordinateRelativeToOrigin(e),i=this.renderer.grid.getGridCoordinateRelativeToOriginFromCanvasCoordinate(n),o=n.plus(this.renderer.grid.canvasTranslation),r=this.renderer.grid.getGridCoordinateFromCanvasCoordinate(o),a=this.getComponentsWithinGridCoordinate(r);if(0==t)if(this.lastLeftMouseDownEventInfo.setEvent(e,a),console.log("down"),console.log("mouseCanvasCoordinateRelativeToOrigin "+n),console.log("mouseCanvasCoordinate "+o),console.log("mouseGridCoordinateRelativeToOrigin "+i),console.log("mouseGridCoordinate "+r),console.log(this.renderer.grid.toString()),e.ctrlKey)this.isDraggingGrid=!0;else if(null==a){let e=new s(r);this.renderer.componentTree.addComponent(e)}else this.isDraggingComponent=!0;2==t&&this.lastRightMouseDownEventInfo.setEvent(e,a),this.drawCall()}onCanvasMouseUp(e){let t=e.button;0==t&&(this.isDraggingComponent=!1,this.isDraggingGrid=!1,console.log(this.renderer.grid.toString()),console.log("up")),this.drawCall()}onCanvasMouseMove(e){if(this.isDraggingComponent){let t=this.getMouseCanvasCoordinateRelativeToOrigin(e).plus(this.renderer.grid.canvasTranslation),n=this.renderer.grid.getGridCoordinateRelativeToOriginFromCanvasCoordinate(t),i=this.lastLeftMouseDownEventInfo.hitComponent;null==i||i.moveTo(n)}if(this.isDraggingGrid){let t=this.getMouseCanvasCoordinateRelativeToOrigin(e);t.plus(this.renderer.grid.canvasTranslation);if(this.lastMouseMoveEventInfo.event instanceof MouseEvent){let e=this.getMouseCanvasCoordinateRelativeToOrigin(this.lastMouseMoveEventInfo.event),n=t.minus(e);this.renderer.grid.translateByCanvasCoordinate(n)}}this.lastMouseMoveEventInfo.setEvent(e,null),this.drawCall()}onCanvasScroll(e){this.renderer.grid.scaleFactor;let t=0;e.deltaY<0?t=1.05:e.deltaY>0&&(t=.95);let n=this.getMouseCanvasCoordinateRelativeToOrigin(e),i=this.renderer.grid.getGridCoordinateRelativeToOriginFromCanvasCoordinate(n);console.log("mouseCanvasCoordinate"+n.toString()),this.renderer.grid.zoomBy(t);let o=this.renderer.grid.getCanvasCoordinateFromGridCoordinate(i),r=n.minus(o);console.log("shouldTranslateByCanvasCoordinate"+r.toString()),this.renderer.grid.translateByCanvasCoordinate(r),this.drawCall()}drawCall(){this.renderer.draw()}}(d,h)}]);